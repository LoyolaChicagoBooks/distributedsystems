

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>BitTorrent &mdash; Distributed Systems Updated 2021-07-20 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hadoop Distributed File System" href="../hadoop/hadoop.html" />
    <link rel="prev" title="Apache Spark" href="../apache_spark/apache_spark.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Distributed Systems
          

          
          </a>

          
            
            
              <div class="version">
                Updated 2021-07-20
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../issues/issues.html">Introduction and Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/networking.html">Networking Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concurrency/concurrency.html">Concurrency and Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html">Distributed Systems and Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#storage-devices">Storage Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#local-storage">Local Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#distributed-filesystems">Distributed Filesystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#case-study-sun-nfs">Case Study - SUN NFS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../directories/directories.html">Directories and LDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maven/maven.html">Project Build Management With Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/ci.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clocks/clocks.html">Clocks and Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trans/trans.html">Distributed Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dns/dns.html">Domain Name Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../queue/queue.html">Distributed Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mpi/mpi.html">Message Passing Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smtp/smtp.html">SMTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corba/corba.html">Object Brokers and CORBA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest/rest.html">REST and Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nosql/nosql.html">NoSQL Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.html">Distributed Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apache_spark/apache_spark.html">Apache Spark</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BitTorrent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-it-works">How It Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#piece-selection-policy">Piece Selection Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-and-share-torrent-files">Create and Share Torrent Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choking-and-optimistic-unchoking-algorithm">Choking and Optimistic Unchoking Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#peer-protocol">Peer Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distributed-characteristics">Distributed Characteristics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advantages">Advantages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#disadvantages">Disadvantages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../hadoop/hadoop.html">Hadoop Distributed File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../message_queues/message_queues.html">Message Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../object_brokering/object_brokering.html">Object Brokering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsync/rsync.html">File Sychronization and rsync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../volunteer/volunteer.html">Volunteer Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud/cloud.html">Cloud Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iot/iot.html">Internet of Things and Pervasive Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../election/election.html">Election Algorithms</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Distributed Systems</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>BitTorrent</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/bit_torrent/bit_torrent.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bittorrent">
<h1>BitTorrent<a class="headerlink" href="#bittorrent" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>BitTorrent is a protocol for peer-to-peer content sharing over the Internet.</p></li>
<li><p>In November 2004 BitTorrent share of the whole Internet Traffic was estimated at 35% (Wikipedia).</p></li>
<li><p>The protocol was designed by Bram Cohen in 2001.</p></li>
<li><p>Bram Cohen released an implementation in the same year.</p></li>
<li><p>The final Version was released in 2008.</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/BitTorrentModel.png"><img alt="Figure 1" src="../_images/BitTorrentModel.png" style="width: 700px; height: 600px;" /></a>
</div>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Seeder</dt><dd><p>A peer with complete file is called seeder.
Initially there is only one seeder (the one who uploads the file).
Peers who download the file completely and contunue to share, become seeders.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Peer</dt><dd><p>A host that is in process of downloading the file while uploading at the same time. This is sometimes called a leecher as well; however, the term leecher is sometimes used for peers that just download and decide to not upload.</p>
</dd>
</dl>
</li>
<li><p>Bencoding
Messages exchanged between peers and trackers are bencoded as explained below:</p>
<ul>
<li><p>Strings are prefixed with an integer representing their length followed by a colon and the string itself. For example 4:info corresponds to ‘info’</p></li>
<li><p>Integers are prefixed by an i followed by the integer and ending with an e. Example, i3e corresponds to 3.</p></li>
<li><p>Lists are prefixed with l followed by elements (also bencoded) ending with e. Example l4:info3:abce corresponds to [‘info’, ‘abc’]</p></li>
<li><p>Dictionaries are prefixed by d followed by an alternating list of keys and values, and they end in e. For example, d1:a4:spam1:b4:infoe corresponds to {‘a’: ‘spam’, ‘b’: ‘info’}</p></li>
</ul>
</li>
<li><p>Metainfo (.torrent) File</p>
<ul>
<li><p>A light-weight file that contains meta-data about the file(s), trackers, etc. as explained below.</p></li>
<li><p>URL of the tracker(s).</p></li>
<li><p>info field which is a dictionary with the following elements</p>
<ul>
<li><p>name: maps to the name of the file/directory being shared</p></li>
<li><p>piece length: The size of the file pieces.</p></li>
<li><p>length: Length of the file in bytes.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Tracker</p>
<ul>
<li><p>A host that coordinates file distribution.</p></li>
<li><p>Maintains IP address, port number and an ID for every peer.</p></li>
<li><p>Transfer state for peers: downloading, completed.</p></li>
<li><p>It returs a random list of peers to the clients when requested.</p></li>
<li><p>Peers send Tracker GET requests to trackers and they get Responses back from the tracker.</p></li>
<li><p>Tracker GET requests have the following fields</p>
<ul>
<li><p>info_hash: a sha1 hash of the metainfo file</p></li>
<li><p>peer_id: a 20 byte identifier that the peer generates when it first starts</p></li>
<li><p>ip: The IP address of the peer</p></li>
<li><p>port: The port number that the peer uses</p></li>
<li><p>uploaded: The total amount (in bytes) uploaded so far</p></li>
<li><p>downloaded: The total amount (in bytes) this peer has downloaded so far</p></li>
<li><p>left: The amount (in bytes) this peer has yet to download to complete download</p></li>
<li><p>event: An optional key that maps to one of ‘completed’, ‘started’, stopped’. The peers can inform the trackers of their status using event messages.</p></li>
</ul>
</li>
<li><p>Tracker responses are dictionaries with the following elements:</p>
<ul>
<li><p>interval: Number of seconds downloader should wait before sending another request</p></li>
<li><p>peers: A list of dictionaries corresponding to peers</p></li>
<li><p>failure reason: A string explaining the reason why the request failed, in case there is a failure</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="how-it-works">
<h2>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>BitTorrent client is the tool used to achieve the majority of the activities in sharing.</p></li>
<li><p>The file(s) being distribted is divided into pieces.</p>
<ul>
<li><p>When a peer receives a piece, it can then redistribute it to other peers.</p></li>
<li><p>Pieces are protected by a cryptographic hash so as to avoid accidental or malicious modification.</p></li>
<li><p>Pieces are distributed non-sequentially and the client rearranges them when it receives all the pieces.</p></li>
<li><p>Piece size can be set arbitrarily by the client. For example, with piece size of 1 MB a 10 MB file will divided into 10 equal pieces and will be shared in chunks of 1 MB.</p></li>
</ul>
</li>
<li><p>Transfer is done via TCP as follows:</p>
<ul>
<li><p>The protocol makes sure that several requests are pending before a piece is being sent.</p></li>
<li><p>At the receiving end once a piece arrives, another request is sent.</p></li>
<li><p>At any point in time, a specific number of pieces (usually 5) is requested.</p></li>
</ul>
</li>
</ul>
<div class="section" id="piece-selection-policy">
<h3>Piece Selection Policy<a class="headerlink" href="#piece-selection-policy" title="Permalink to this headline">¶</a></h3>
<p>If pieces are not selected in a well-thought way, all peers may endup having downloaded the same pieces but some (of the more difficult pieces) may be missing. If the seeder disappears preamturely, all peers may end up with incomplete files.
To solve this issue, one or more of the following policies are used:</p>
<ul class="simple">
<li><p>Random First Piece Selection</p>
<ul>
<li><p>Initially the peer has no pieces.</p></li>
<li><p>Select a first piece and downoad it as soon as possibly.</p></li>
<li><p>Select a random piece of the file and download it.</p></li>
</ul>
</li>
<li><p>Rarest Piece First</p>
<ul>
<li><p>Determine the piecest that are not found or are rare among the peers and download those first.</p></li>
<li><p>This ensures that the common pieces are left towards the end to be downloaded.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="create-and-share-torrent-files">
<h3>Create and Share Torrent Files<a class="headerlink" href="#create-and-share-torrent-files" title="Permalink to this headline">¶</a></h3>
<p>When a user wants to share a file, they would create a torrent file (Torrent files are identified by .torrent extension) using the client application.
The torrent file wraps around information such as the specifi file(s) to be shared, location of the file(s) on the seed machine, etc.
The torrent file is then shared with other peers.
The original uploader is known as seed/seeder and others who start downloading from seeder are known as peers or leechers.</p>
</div>
<div class="section" id="choking-and-optimistic-unchoking-algorithm">
<h3>Choking and Optimistic Unchoking Algorithm<a class="headerlink" href="#choking-and-optimistic-unchoking-algorithm" title="Permalink to this headline">¶</a></h3>
<p>Choking is a mechanism using which the BitTorrent protocol avoids free riders, those who want to download but not upload.
Also, choking helps tackle network congestion???</p>
<ol class="arabic simple">
<li><p>Upload one file piece to peer p</p></li>
<li><p>Repeat 1 N times // N is typically between 2 and 5</p></li>
<li><p>If peer p uploads data go to 1 else go to 4</p></li>
<li><p>Stop uploading to p for S seconds</p></li>
<li><p>After S seconds go to step 1</p></li>
</ol>
<p>The above procedure is applied for all peers. The last step is called optimistic unchoking. This way the algorithm makes sure that no peers are choked permanently.
This is a simplistic procedure for choking/unchoking mechanism. The real algorithm may be more complex depending on implementation.
In the the case where the uploader is a seeder rather than a simple peer, the overall upload rate for the downloading peer is checked and then it is decided whether to chokoe or unchoke.
And finally the seeders and peers upoad to those peers with the highest upload rate. This way, the protocol makes sure that the the uploads complete fast and the number of replica is large.</p>
</div>
<div class="section" id="peer-protocol">
<h3>Peer Protocol<a class="headerlink" href="#peer-protocol" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Peer connections are symmetrical: same data can be sent in both directions</p></li>
<li><p>File pieces are referred to by indexes</p></li>
<li><p>When a peer finishes downloading a piece it announces to all other peers that it has that piece</p></li>
<li><p>Connections on both sides contain two bits of state: choked/unchoked and interested/not_interested</p></li>
<li><p>Choking the status indicating that no data can be sent until the unchoking happens</p></li>
<li><p>Data transfer happens when one side is interested and the other side is not choking</p></li>
<li><p>Connections start in unchoked and not-interested state</p></li>
<li><p>Downloaders should keep several piece requests queued for best TCP performance</p></li>
<li><p>The peer data stream is started by a handshake and followed by a continuous stream of data transfers</p></li>
<li><p>The first chunk of bytes is the header</p></li>
<li><p>Next comes the 20 byte hash of the info value from the metainfo file i.e. the info_hash</p></li>
<li><p>Then comes the 20 byte peer id</p></li>
<li><p>At this point handshake is finished and an alternating stream of length prefixes and messages continue flowing</p></li>
<li><p>Peer messages start with a byte that specifies their type as follows:</p>
<ul>
<li><p>0: choke</p></li>
<li><p>1: unchoke</p></li>
<li><p>2: interested</p></li>
<li><p>3: not interested</p></li>
<li><p>4: have</p></li>
<li><p>5: bitfield</p></li>
<li><p>6: request</p></li>
<li><p>7: piece</p></li>
<li><p>8: cancel</p></li>
</ul>
</li>
</ul>
<p>choke, unchoke, interested and not interested have no payload.
The ‘have’ message has a number as its payload which is the index of the piece the downloader has just completed.
Cancel messages are sent when the download is completed.</p>
</div>
<div class="section" id="distributed-characteristics">
<h3>Distributed Characteristics<a class="headerlink" href="#distributed-characteristics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Support for resource sharing</p>
<ul>
<li><p>Trackers are used to make sure that resources are shared among as many peers as possible</p></li>
</ul>
</li>
<li><p>Openness</p>
<ul>
<li><p>The specification is open for implementation.</p></li>
<li><p>No restriction to any particular platform whatsover. There are implementations for various platforms.</p></li>
</ul>
</li>
<li><p>Concurrency</p>
<ul>
<li><p>Each peer is both a client and server</p></li>
<li><p>Many processes interact to achieve the job</p></li>
</ul>
</li>
<li><p>Scalability</p>
<ul>
<li><p>Peers are added or removed seamlessly without affecting the reliability of the system.</p></li>
<li><p>New trackers can be added and old one can disappear without much effect to the whole system.</p></li>
</ul>
</li>
<li><p>Fault Tolerance</p>
<ul>
<li><p>When peers appear or disappear at random, the system is not affected significantly as long as there is at least one seeder.</p></li>
<li><p>One or more trackers should always exist to propogate peers information.</p></li>
<li><p>If number of seeders goes to zero, peers keep sharing the portions of the files that they have. This might mean that the file(s) might be incomplete. As soon as a seeder re-appears all peers can catch up and get the whole file(s).</p></li>
<li><p>There are implementations in which there is no need for trackers.</p></li>
</ul>
</li>
<li><p>Transparency</p>
<ul>
<li><p>All details are hidden from the end users.</p></li>
<li><p>It looks much like a normal client-server download manager</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="advantages">
<h3>Advantages<a class="headerlink" href="#advantages" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Economical: Almost no maintenance cost is involved</p></li>
<li><p>It is very efficient since every participant is a content provider. No dependency on a single party.</p></li>
<li><p>Highly extensible: peers join and leave with almost no effect on the content with the exception that there always should be at least one seeder.</p></li>
<li><p>It is reliable: As long as there is one seeder (and more peers), it is guaranteed that the system works well.</p></li>
<li><p>It gives flexibility: The work is evenly distributed among peers.</p></li>
</ul>
</div>
<div class="section" id="disadvantages">
<h3>Disadvantages<a class="headerlink" href="#disadvantages" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If there is no seeder, for some content the peers may end up exchanging only part of the whole content.</p></li>
<li><p>Peers are loosely dependent on one another for bandwidth.</p></li>
<li><p>Designed for public file sharing and hence not the best option for private sharing</p></li>
<li><p>Copyright infringment concerns: it is hard to control whether the shared resources for copyright infringement.</p></li>
</ul>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>BitTorrent Official specification: <a class="reference external" href="http://www.bittorrent.org/beps/bep_0003.html">http://www.bittorrent.org/beps/bep_0003.html</a></p></li>
<li><p>Wikipedia entry: <a class="reference external" href="http://en.wikipedia.org/wiki/BitTorrent">http://en.wikipedia.org/wiki/BitTorrent</a></p></li>
<li><p>The Pirate Bay, a BitTorrent distribution server: <a class="reference external" href="http://thepiratebay.sx/">http://thepiratebay.sx/</a></p></li>
<li><p>An example of list of trackers: <a class="reference external" href="http://tech.thaweesha.com/2013/02/torrent-tracker-list-2013.html">http://tech.thaweesha.com/2013/02/torrent-tracker-list-2013.html</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../hadoop/hadoop.html" class="btn btn-neutral float-right" title="Hadoop Distributed File System" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../apache_spark/apache_spark.html" class="btn btn-neutral float-left" title="Apache Spark" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2013-2019, George K. Thiruvathukal and Sarah Kaylor.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>