<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" metia="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
<title>BitTorrent | Distributed Systems: updated 18 May 2023</title>
<meta content="BitTorrent | Distributed Systems: updated 18 May 2023" property="og:title"/>
<meta content="BitTorrent | Distributed Systems: updated 18 May 2023" name="twitter:title"/>
<link href="../_static/pygments.css" rel="stylesheet"/>
<link href="../_static/theme.a16405b310edf0713aee.css" rel="stylesheet"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../hadoop/hadoop.html" rel="next" title="Hadoop Distributed File System"/>
<link href="../apache_spark/apache_spark.html" rel="prev" title="Apache Spark"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/sphinx_highlight.js"></script>
<script defer="" src="../_static/theme.ad172c0f1249198ea036.js"></script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a>
<header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../index.html"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Distributed Systems: updated 18 May 2023</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none">
<form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">âŒ˜</span>
      K
    </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../index.html"><span class="font-bold text-clip whitespace-nowrap">Distributed Systems: updated 18 May 2023</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../issues/issues.html">Introduction and Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/networking.html">Networking Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concurrency/concurrency.html">Concurrency and Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html">Distributed Systems and Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#storage-devices">Storage Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#local-storage">Local Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#distributed-filesystems">Distributed Filesystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#case-study-sun-nfs">Case Study - SUN NFS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../directories/directories.html">Directories and LDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maven/maven.html">Project Build Management With Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/ci.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clocks/clocks.html">Clocks and Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trans/trans.html">Distributed Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dns/dns.html">Domain Name Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../queue/queue.html">Distributed Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mpi/mpi.html">Message Passing Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smtp/smtp.html">SMTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corba/corba.html">Object Brokers and CORBA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest/rest.html">REST and Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nosql/nosql.html">NoSQL Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.html">Distributed Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apache_spark/apache_spark.html">Apache Spark</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BitTorrent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hadoop/hadoop.html">Hadoop Distributed File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../message_queues/message_queues.html">Message Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../object_brokering/object_brokering.html">Object Brokering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsync/rsync.html">File Sychronization and rsync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../volunteer/volunteer.html">Volunteer Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud/cloud.html">Cloud Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iot/iot.html">Internet of Things and Pervasive Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../election/election.html">Election Algorithms</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../index.html">
<span class="hidden md:inline">Distributed Systems: updated 18 May 2023</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">BitTorrent</span>
</nav>
<div id="content" role="main">
<section id="bittorrent">
<h1>BitTorrent<a class="headerlink" href="#bittorrent" title="Permalink to this heading">Â¶</a></h1>
<ul class="simple">
<li><p>BitTorrent is a protocol for peer-to-peer content sharing over the Internet.</p></li>
<li><p>In November 2004 BitTorrent share of the whole Internet Traffic was estimated at 35% (Wikipedia).</p></li>
<li><p>The protocol was designed by Bram Cohen in 2001.</p></li>
<li><p>Bram Cohen released an implementation in the same year.</p></li>
<li><p>The final Version was released in 2008.</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/BitTorrentModel.png"><img alt="Figure 1" src="../_images/BitTorrentModel.png" style="width: 700px; height: 600px;"/></a>
</figure>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#terminology'">Â¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Seeder</dt><dd><p>A peer with complete file is called seeder.
Initially there is only one seeder (the one who uploads the file).
Peers who download the file completely and contunue to share, become seeders.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Peer</dt><dd><p>A host that is in process of downloading the file while uploading at the same time. This is sometimes called a leecher as well; however, the term leecher is sometimes used for peers that just download and decide to not upload.</p>
</dd>
</dl>
</li>
<li><p>Bencoding
Messages exchanged between peers and trackers are bencoded as explained below:</p>
<ul>
<li><p>Strings are prefixed with an integer representing their length followed by a colon and the string itself. For example 4:info corresponds to â€˜infoâ€™</p></li>
<li><p>Integers are prefixed by an i followed by the integer and ending with an e. Example, i3e corresponds to 3.</p></li>
<li><p>Lists are prefixed with l followed by elements (also bencoded) ending with e. Example l4:info3:abce corresponds to [â€˜infoâ€™, â€˜abcâ€™]</p></li>
<li><p>Dictionaries are prefixed by d followed by an alternating list of keys and values, and they end in e. For example, d1:a4:spam1:b4:infoe corresponds to {â€˜aâ€™: â€˜spamâ€™, â€˜bâ€™: â€˜infoâ€™}</p></li>
</ul>
</li>
<li><p>Metainfo (.torrent) File</p>
<ul>
<li><p>A light-weight file that contains meta-data about the file(s), trackers, etc. as explained below.</p></li>
<li><p>URL of the tracker(s).</p></li>
<li><p>info field which is a dictionary with the following elements</p>
<ul>
<li><p>name: maps to the name of the file/directory being shared</p></li>
<li><p>piece length: The size of the file pieces.</p></li>
<li><p>length: Length of the file in bytes.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Tracker</p>
<ul>
<li><p>A host that coordinates file distribution.</p></li>
<li><p>Maintains IP address, port number and an ID for every peer.</p></li>
<li><p>Transfer state for peers: downloading, completed.</p></li>
<li><p>It returs a random list of peers to the clients when requested.</p></li>
<li><p>Peers send Tracker GET requests to trackers and they get Responses back from the tracker.</p></li>
<li><p>Tracker GET requests have the following fields</p>
<ul>
<li><p>info_hash: a sha1 hash of the metainfo file</p></li>
<li><p>peer_id: a 20 byte identifier that the peer generates when it first starts</p></li>
<li><p>ip: The IP address of the peer</p></li>
<li><p>port: The port number that the peer uses</p></li>
<li><p>uploaded: The total amount (in bytes) uploaded so far</p></li>
<li><p>downloaded: The total amount (in bytes) this peer has downloaded so far</p></li>
<li><p>left: The amount (in bytes) this peer has yet to download to complete download</p></li>
<li><p>event: An optional key that maps to one of â€˜completedâ€™, â€˜startedâ€™, stoppedâ€™. The peers can inform the trackers of their status using event messages.</p></li>
</ul>
</li>
<li><p>Tracker responses are dictionaries with the following elements:</p>
<ul>
<li><p>interval: Number of seconds downloader should wait before sending another request</p></li>
<li><p>peers: A list of dictionaries corresponding to peers</p></li>
<li><p>failure reason: A string explaining the reason why the request failed, in case there is a failure</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="how-it-works">
<h2>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#how-it-works'">Â¶</a></h2>
<ul class="simple">
<li><p>BitTorrent client is the tool used to achieve the majority of the activities in sharing.</p></li>
<li><p>The file(s) being distribted is divided into pieces.</p>
<ul>
<li><p>When a peer receives a piece, it can then redistribute it to other peers.</p></li>
<li><p>Pieces are protected by a cryptographic hash so as to avoid accidental or malicious modification.</p></li>
<li><p>Pieces are distributed non-sequentially and the client rearranges them when it receives all the pieces.</p></li>
<li><p>Piece size can be set arbitrarily by the client. For example, with piece size of 1 MB a 10 MB file will divided into 10 equal pieces and will be shared in chunks of 1 MB.</p></li>
</ul>
</li>
<li><p>Transfer is done via TCP as follows:</p>
<ul>
<li><p>The protocol makes sure that several requests are pending before a piece is being sent.</p></li>
<li><p>At the receiving end once a piece arrives, another request is sent.</p></li>
<li><p>At any point in time, a specific number of pieces (usually 5) is requested.</p></li>
</ul>
</li>
</ul>
<section id="piece-selection-policy">
<h3>Piece Selection Policy<a class="headerlink" href="#piece-selection-policy" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#piece-selection-policy'">Â¶</a></h3>
<p>If pieces are not selected in a well-thought way, all peers may endup having downloaded the same pieces but some (of the more difficult pieces) may be missing. If the seeder disappears preamturely, all peers may end up with incomplete files.
To solve this issue, one or more of the following policies are used:</p>
<ul class="simple">
<li><p>Random First Piece Selection</p>
<ul>
<li><p>Initially the peer has no pieces.</p></li>
<li><p>Select a first piece and downoad it as soon as possibly.</p></li>
<li><p>Select a random piece of the file and download it.</p></li>
</ul>
</li>
<li><p>Rarest Piece First</p>
<ul>
<li><p>Determine the piecest that are not found or are rare among the peers and download those first.</p></li>
<li><p>This ensures that the common pieces are left towards the end to be downloaded.</p></li>
</ul>
</li>
</ul>
</section>
<section id="create-and-share-torrent-files">
<h3>Create and Share Torrent Files<a class="headerlink" href="#create-and-share-torrent-files" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#create-and-share-torrent-files'">Â¶</a></h3>
<p>When a user wants to share a file, they would create a torrent file (Torrent files are identified by .torrent extension) using the client application.
The torrent file wraps around information such as the specifi file(s) to be shared, location of the file(s) on the seed machine, etc.
The torrent file is then shared with other peers.
The original uploader is known as seed/seeder and others who start downloading from seeder are known as peers or leechers.</p>
</section>
<section id="choking-and-optimistic-unchoking-algorithm">
<h3>Choking and Optimistic Unchoking Algorithm<a class="headerlink" href="#choking-and-optimistic-unchoking-algorithm" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#choking-and-optimistic-unchoking-algorithm'">Â¶</a></h3>
<p>Choking is a mechanism using which the BitTorrent protocol avoids free riders, those who want to download but not upload.
Also, choking helps tackle network congestion???</p>
<ol class="arabic simple">
<li><p>Upload one file piece to peer p</p></li>
<li><p>Repeat 1 N times // N is typically between 2 and 5</p></li>
<li><p>If peer p uploads data go to 1 else go to 4</p></li>
<li><p>Stop uploading to p for S seconds</p></li>
<li><p>After S seconds go to step 1</p></li>
</ol>
<p>The above procedure is applied for all peers. The last step is called optimistic unchoking. This way the algorithm makes sure that no peers are choked permanently.
This is a simplistic procedure for choking/unchoking mechanism. The real algorithm may be more complex depending on implementation.
In the the case where the uploader is a seeder rather than a simple peer, the overall upload rate for the downloading peer is checked and then it is decided whether to chokoe or unchoke.
And finally the seeders and peers upoad to those peers with the highest upload rate. This way, the protocol makes sure that the the uploads complete fast and the number of replica is large.</p>
</section>
<section id="peer-protocol">
<h3>Peer Protocol<a class="headerlink" href="#peer-protocol" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#peer-protocol'">Â¶</a></h3>
<ul class="simple">
<li><p>Peer connections are symmetrical: same data can be sent in both directions</p></li>
<li><p>File pieces are referred to by indexes</p></li>
<li><p>When a peer finishes downloading a piece it announces to all other peers that it has that piece</p></li>
<li><p>Connections on both sides contain two bits of state: choked/unchoked and interested/not_interested</p></li>
<li><p>Choking the status indicating that no data can be sent until the unchoking happens</p></li>
<li><p>Data transfer happens when one side is interested and the other side is not choking</p></li>
<li><p>Connections start in unchoked and not-interested state</p></li>
<li><p>Downloaders should keep several piece requests queued for best TCP performance</p></li>
<li><p>The peer data stream is started by a handshake and followed by a continuous stream of data transfers</p></li>
<li><p>The first chunk of bytes is the header</p></li>
<li><p>Next comes the 20 byte hash of the info value from the metainfo file i.e. the info_hash</p></li>
<li><p>Then comes the 20 byte peer id</p></li>
<li><p>At this point handshake is finished and an alternating stream of length prefixes and messages continue flowing</p></li>
<li><p>Peer messages start with a byte that specifies their type as follows:</p>
<ul>
<li><p>0: choke</p></li>
<li><p>1: unchoke</p></li>
<li><p>2: interested</p></li>
<li><p>3: not interested</p></li>
<li><p>4: have</p></li>
<li><p>5: bitfield</p></li>
<li><p>6: request</p></li>
<li><p>7: piece</p></li>
<li><p>8: cancel</p></li>
</ul>
</li>
</ul>
<p>choke, unchoke, interested and not interested have no payload.
The â€˜haveâ€™ message has a number as its payload which is the index of the piece the downloader has just completed.
Cancel messages are sent when the download is completed.</p>
</section>
<section id="distributed-characteristics">
<h3>Distributed Characteristics<a class="headerlink" href="#distributed-characteristics" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#distributed-characteristics'">Â¶</a></h3>
<ul class="simple">
<li><p>Support for resource sharing</p>
<ul>
<li><p>Trackers are used to make sure that resources are shared among as many peers as possible</p></li>
</ul>
</li>
<li><p>Openness</p>
<ul>
<li><p>The specification is open for implementation.</p></li>
<li><p>No restriction to any particular platform whatsover. There are implementations for various platforms.</p></li>
</ul>
</li>
<li><p>Concurrency</p>
<ul>
<li><p>Each peer is both a client and server</p></li>
<li><p>Many processes interact to achieve the job</p></li>
</ul>
</li>
<li><p>Scalability</p>
<ul>
<li><p>Peers are added or removed seamlessly without affecting the reliability of the system.</p></li>
<li><p>New trackers can be added and old one can disappear without much effect to the whole system.</p></li>
</ul>
</li>
<li><p>Fault Tolerance</p>
<ul>
<li><p>When peers appear or disappear at random, the system is not affected significantly as long as there is at least one seeder.</p></li>
<li><p>One or more trackers should always exist to propogate peers information.</p></li>
<li><p>If number of seeders goes to zero, peers keep sharing the portions of the files that they have. This might mean that the file(s) might be incomplete. As soon as a seeder re-appears all peers can catch up and get the whole file(s).</p></li>
<li><p>There are implementations in which there is no need for trackers.</p></li>
</ul>
</li>
<li><p>Transparency</p>
<ul>
<li><p>All details are hidden from the end users.</p></li>
<li><p>It looks much like a normal client-server download manager</p></li>
</ul>
</li>
</ul>
</section>
<section id="advantages">
<h3>Advantages<a class="headerlink" href="#advantages" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#advantages'">Â¶</a></h3>
<ul class="simple">
<li><p>Economical: Almost no maintenance cost is involved</p></li>
<li><p>It is very efficient since every participant is a content provider. No dependency on a single party.</p></li>
<li><p>Highly extensible: peers join and leave with almost no effect on the content with the exception that there always should be at least one seeder.</p></li>
<li><p>It is reliable: As long as there is one seeder (and more peers), it is guaranteed that the system works well.</p></li>
<li><p>It gives flexibility: The work is evenly distributed among peers.</p></li>
</ul>
</section>
<section id="disadvantages">
<h3>Disadvantages<a class="headerlink" href="#disadvantages" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#disadvantages'">Â¶</a></h3>
<ul class="simple">
<li><p>If there is no seeder, for some content the peers may end up exchanging only part of the whole content.</p></li>
<li><p>Peers are loosely dependent on one another for bandwidth.</p></li>
<li><p>Designed for public file sharing and hence not the best option for private sharing</p></li>
<li><p>Copyright infringment concerns: it is hard to control whether the shared resources for copyright infringement.</p></li>
</ul>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#references'">Â¶</a></h2>
<ul class="simple">
<li><p>BitTorrent Official specification: <a class="reference external" href="http://www.bittorrent.org/beps/bep_0003.html">http://www.bittorrent.org/beps/bep_0003.html</a></p></li>
<li><p>Wikipedia entry: <a class="reference external" href="http://en.wikipedia.org/wiki/BitTorrent">http://en.wikipedia.org/wiki/BitTorrent</a></p></li>
<li><p>The Pirate Bay, a BitTorrent distribution server: <a class="reference external" href="http://thepiratebay.sx/">http://thepiratebay.sx/</a></p></li>
<li><p>An example of list of trackers: <a class="reference external" href="http://tech.thaweesha.com/2013/02/torrent-tracker-list-2013.html">http://tech.thaweesha.com/2013/02/torrent-tracker-list-2013.html</a></p></li>
</ul>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(var(--vh)-4rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#terminology'" class="reference internal" href="#terminology">Terminology</a></li>
<li><a :data-current="activeSection === '#how-it-works'" class="reference internal" href="#how-it-works">How It Works</a><ul>
<li><a :data-current="activeSection === '#piece-selection-policy'" class="reference internal" href="#piece-selection-policy">Piece Selection Policy</a></li>
<li><a :data-current="activeSection === '#create-and-share-torrent-files'" class="reference internal" href="#create-and-share-torrent-files">Create and Share Torrent Files</a></li>
<li><a :data-current="activeSection === '#choking-and-optimistic-unchoking-algorithm'" class="reference internal" href="#choking-and-optimistic-unchoking-algorithm">Choking and Optimistic Unchoking Algorithm</a></li>
<li><a :data-current="activeSection === '#peer-protocol'" class="reference internal" href="#peer-protocol">Peer Protocol</a></li>
<li><a :data-current="activeSection === '#distributed-characteristics'" class="reference internal" href="#distributed-characteristics">Distributed Characteristics</a></li>
<li><a :data-current="activeSection === '#advantages'" class="reference internal" href="#advantages">Advantages</a></li>
<li><a :data-current="activeSection === '#disadvantages'" class="reference internal" href="#disadvantages">Disadvantages</a></li>
</ul>
</li>
<li><a :data-current="activeSection === '#references'" class="reference internal" href="#references">References</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">Â© 2013-2019, Distributed Systems Instructors at Loyola University ChicagoÂ Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 6.2.1</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>