<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" metia="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Clocks and Synchronization | Distributed Systems: updated 18 May 2023</title>
<meta content="Clocks and Synchronization | Distributed Systems: updated 18 May 2023" property="og:title"/>
<meta content="Clocks and Synchronization | Distributed Systems: updated 18 May 2023" name="twitter:title"/>
<link href="../_static/pygments.css" rel="stylesheet"/>
<link href="../_static/theme.a16405b310edf0713aee.css" rel="stylesheet"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../trans/trans.html" rel="next" title="Distributed Transactions"/>
<link href="../ci/ci.html" rel="prev" title="Continuous Integration"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/sphinx_highlight.js"></script>
<script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script defer="" src="../_static/theme.ad172c0f1249198ea036.js"></script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a>
<header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../index.html"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Distributed Systems: updated 18 May 2023</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none">
<form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
      K
    </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../index.html"><span class="font-bold text-clip whitespace-nowrap">Distributed Systems: updated 18 May 2023</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../issues/issues.html">Introduction and Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/networking.html">Networking Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concurrency/concurrency.html">Concurrency and Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html">Distributed Systems and Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#storage-devices">Storage Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#local-storage">Local Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#distributed-filesystems">Distributed Filesystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage/storage.html#case-study-sun-nfs">Case Study - SUN NFS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../directories/directories.html">Directories and LDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maven/maven.html">Project Build Management With Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/ci.html">Continuous Integration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Clocks and Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trans/trans.html">Distributed Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dns/dns.html">Domain Name Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../queue/queue.html">Distributed Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mpi/mpi.html">Message Passing Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smtp/smtp.html">SMTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corba/corba.html">Object Brokers and CORBA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest/rest.html">REST and Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nosql/nosql.html">NoSQL Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.html">Distributed Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apache_spark/apache_spark.html">Apache Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bit_torrent/bit_torrent.html">BitTorrent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hadoop/hadoop.html">Hadoop Distributed File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../message_queues/message_queues.html">Message Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../object_brokering/object_brokering.html">Object Brokering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsync/rsync.html">File Sychronization and rsync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../volunteer/volunteer.html">Volunteer Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud/cloud.html">Cloud Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iot/iot.html">Internet of Things and Pervasive Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../election/election.html">Election Algorithms</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../index.html">
<span class="hidden md:inline">Distributed Systems: updated 18 May 2023</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Clocks and Synchronization</span>
</nav>
<div id="content" role="main">
<section id="clocks-and-synchronization">
<h1>Clocks and Synchronization<a class="headerlink" href="#clocks-and-synchronization" title="Permalink to this heading">¶</a></h1>
<section id="what-is-time-some-physics">
<h2>What is Time? Some Physics<a class="headerlink" href="#what-is-time-some-physics" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#what-is-time-some-physics'">¶</a></h2>
<ul class="simple">
<li><p>The understanding of time has evolved greatly in the past 150 years.</p></li>
<li><dl class="simple">
<dt>With Einstein’s Special and General Relativity Theories, we’ve come to understand:</dt><dd><ul>
<li><p>That time is interwoven with space</p></li>
<li><p>Time is relative to the reference frame of an observer</p></li>
<li><p>We now know that simultaneity is a relative concept. Two events A and B occurring simultaneously in one reference frame may appear to be ordered A then B in another frame and B then A in yet another reference frame.</p></li>
<li><p>All of this is true without invalidating the observations our causal relationships observed in any reference frame.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<figure class="align-default" id="id1">
<img alt="../_images/Relativity_of_Simultaneity.svg" src="../_images/Relativity_of_Simultaneity.svg"/><figcaption>
<p><span class="caption-text">Two events in space-time. The green observer sees A and B happening at the same time since the two events happen on the same X time plane for A. For the red observer, B is encountered first, then A second. For the blue observer A happens first, and B second. (Image taken from <a class="reference external" href="http://commons.wikipedia.org/wiki/File:Relativity_of_Simultaneity.*">http://commons.wikipedia.org/wiki/File:Relativity_of_Simultaneity.*</a> under the Creative Commons License.)</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="time-and-computation">
<h2>Time and Computation<a class="headerlink" href="#time-and-computation" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#time-and-computation'">¶</a></h2>
<ul class="simple">
<li><p>This dive into physics is not so much to give a lesson in physics, but to impress upon you the underlying complexity of something most people take for granted every day.</p></li>
<li><p>In a similar fashion, in computation, the concept of time measurement can be very complicated</p></li>
<li><p>When building a distributed system, do not take it for granted that you can simply trust the clock on the machine that is executing your code.</p></li>
<li><p>More complicated solutions are needed to establish the order of events that have occurred or when they will occur in the future.</p></li>
</ul>
</section>
<section id="physical-clocks">
<h2>Physical Clocks<a class="headerlink" href="#physical-clocks" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#physical-clocks'">¶</a></h2>
<ul class="simple">
<li><p>Computer Timer: an integrated circuit that contains a precisely machined quartz crystal. When kept under tension the quartz crystal oscillates at a well-defined frequency.</p></li>
<li><p>Clock Tick: after a predefined number of oscillations, the timer will generate a clock tick. This clock tick generates a hardware interrupt that causes the computer’s operating system to enter a special routine in which it can update the software clock and run the process scheduler.</p></li>
<li><dl class="simple">
<dt>This system is fairly reliable on one system. With the timer we can define:</dt><dd><ul>
<li><p>simultaneous: all actions that happen between clock ticks</p></li>
<li><p>before: an operation that happens in a previous clock tick</p></li>
<li><p>after: an operation that happens in a subsequent clock tick</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="physical-clocks-multiple-systems">
<h2>Physical Clocks - Multiple Systems<a class="headerlink" href="#physical-clocks-multiple-systems" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#physical-clocks-multiple-systems'">¶</a></h2>
<ul class="simple">
<li><p>Unfortunately, it is impossible for each machined quartz crystal in every computer timer to be exactly the same. These differences create clock skew.</p></li>
<li><p>For example, if a timer interrupts 60 times per second, it should generate 216,000 ticks per hour.</p></li>
<li><p>In practice, the real number of ticks is typically between 215,998 and 216,002 per hour. This means that we aren’t actually getting precisely 60 ticks per second.</p></li>
<li><p>We can say that a timer is within specification if there is some constant p such that:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[1 - p &lt;= \frac{dC}{dT} &lt;= 1 + p\]</div>
<ul class="simple">
<li><p>The constant p is the maximum drift rate of the timer.</p></li>
<li><p>On any two given computers, the drift rate will likely differ.</p></li>
<li><p>To solve this problem, clock synchronization algorithms are necessary.</p></li>
</ul>
</section>
<section id="clock-synchronization">
<h2>Clock Synchronization<a class="headerlink" href="#clock-synchronization" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#clock-synchronization'">¶</a></h2>
<ul class="simple">
<li><p>The common approach to time synchronization has been to have many computers make use of a time server.</p></li>
<li><p>Typically the time server is equipped with special hardware that provides a more accurate time than does a cheaper computer timer</p></li>
<li><p>The challenge with this approach is that there is a delay in the transmission from the time server to the client receiving the time update.</p></li>
<li><p>This delay is not constant for all requests. Some request may be faster and others slower.</p></li>
<li><p>So how do we solve this problem?</p></li>
</ul>
<figure class="align-default">
<img alt="../_images/ntp_request_response.jpg" src="../_images/ntp_request_response.jpg"/>
</figure>
<ul class="simple">
<li><p>The relative time correction C can be calculated as:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[C = \frac{(T_2 - T_1) + (T_3 - T_4)}{2}\]</div>
<ul class="simple">
<li><p>The way this works is that the client sends a packet with <span class="math notranslate nohighlight">\(T_1\)</span> recorded to the time server. The time server will record the receipt time of the packet <span class="math notranslate nohighlight">\(T_2\)</span>. When the response is sent, the time server will write its current time <span class="math notranslate nohighlight">\(T_3\)</span> to the response. When the client receives the response packet, it will record <span class="math notranslate nohighlight">\(T_4\)</span> from its local clock.</p></li>
<li><p>When the value of C is worked out, the client can correct its local clock</p></li>
<li><p>The client must be careful. If the value of C is positive, then C can be added to the software clock</p></li>
<li><p>If the value of C is negative, then the client must artificially decrease the amount of milliseconds added to its software clock each tick until the offset is cleared.</p></li>
<li><p>It is always inadvisable to cause the clock to go backwards. Most software that relies on time will not react well to this.</p></li>
</ul>
</section>
<section id="clocks-synchronization-and-reliability">
<h2>Clocks Synchronization and Reliability<a class="headerlink" href="#clocks-synchronization-and-reliability" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#clocks-synchronization-and-reliability'">¶</a></h2>
<ul class="simple">
<li><p>Always remember: the goal of clock synchronization is to minimize the difference between the accepted actual time and the time on a given client machine</p></li>
<li><p>When this is achieved, it can be said that in a given set of computers that synchronize that their clocks are more closely in sync.</p></li>
<li><p>Even in this case of more accurate and more often corrected for clocks, developers of distributed systems should still be wary of relying on local clock time.</p></li>
<li><p>Because there are corrections going on, the time recorded for an event might have actually happened at a different time on another computer because of differing drift rates of those computer timers.</p></li>
<li><p>Because we have correction of time does not mean that all machines agree on time, it just means they are much closer to each other on average.</p></li>
<li><p>For some distributed systems, this may be sufficient, for others it may not be.</p></li>
</ul>
</section>
<section id="lamports-logical-clocks">
<h2>Lamport’s Logical Clocks<a class="headerlink" href="#lamports-logical-clocks" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#lamports-logical-clocks'">¶</a></h2>
<ul class="simple">
<li><p>An important paper to read - “Time, clocks, and the ordering of events in a distributed system” by Lamport (1978).</p></li>
<li><p>This paper can be looked up on scholar.google.com</p></li>
<li><p>The important contribution of Lamport is that in a distributed system, clocks need not be synchronized absolutely.</p></li>
<li><p>If two processes do not interact, it is not necessary that their clocks be synchronized because the lack of synchronization would not be observable and thus not cause problems.</p></li>
<li><p>It is not important that all processes agree on what the actual time is, but that they agree on the order in which events occur.</p></li>
<li><dl class="simple">
<dt>Rules of Lamport’s Logical Clocks:</dt><dd><ul>
<li><p>Defines a relationship called “happens-before”. <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span> is read as “a happens before b”</p></li>
<li><p>if <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are events in the same process and <span class="math notranslate nohighlight">\(a\)</span> occurs before <span class="math notranslate nohighlight">\(b\)</span>, then <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span> is true.</p></li>
<li><p>if <span class="math notranslate nohighlight">\(a\)</span> is the event of a message being sent by one process and <span class="math notranslate nohighlight">\(b\)</span> is the event of the message being received by another process, then <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span> is true</p></li>
<li><p>“happens-before” is transitive, meaning if <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(b\)</span> -&gt; <span class="math notranslate nohighlight">\(c\)</span>, then <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(c\)</span></p></li>
<li><dl class="simple">
<dt>if <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span> happens between two process, and events <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> occur on another set of processes and these two sets of processes don’t exchange messages then:</dt><dd><ul>
<li><p>we cannot say whether <span class="math notranslate nohighlight">\(x\)</span> -&gt; <span class="math notranslate nohighlight">\(y\)</span> or <span class="math notranslate nohighlight">\(y\)</span> -&gt; <span class="math notranslate nohighlight">\(x\)</span> from the perspective of the first set of processes</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="implementing-lamports-logical-clocks">
<h2>Implementing Lamport’s Logical Clocks<a class="headerlink" href="#implementing-lamports-logical-clocks" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#implementing-lamports-logical-clocks'">¶</a></h2>
<ul class="simple">
<li><p>When a message is transmitted from P1 to P2, P1 will encode the send time into the message.</p></li>
<li><p>When P2 receives the message, it will record the time of receipt</p></li>
<li><p>If P2 discovers that the time of receipt is before the send time, P2 will update its software clock to be one greater than the send time (1 milli second at least)</p></li>
<li><p>If the time at P2 is already greater than the send time, then no action is required for P2</p></li>
<li><p>With these actions the “happens-before” relationship of the message being sent and received is preserved.</p></li>
</ul>
</section>
<section id="limitations-of-lamports-logical-clocks">
<h2>Limitations of Lamport’s Logical Clocks<a class="headerlink" href="#limitations-of-lamports-logical-clocks" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#limitations-of-lamports-logical-clocks'">¶</a></h2>
<ul class="simple">
<li><p>Lamport’s logical clocks lead to a situation where all events in a distributed system are totally ordered. That is, if <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span>, then we can say <span class="math notranslate nohighlight">\(C(a) &lt; C(b)\)</span>.</p></li>
<li><p>Unfortunately, with Lamport’s clocks, nothing can be said about the actual time of a and b. If the logical clock says <span class="math notranslate nohighlight">\(a\)</span> -&gt; <span class="math notranslate nohighlight">\(b\)</span>, that does not mean in reality that a actually happened before b in terms of real time.</p></li>
</ul>
<figure class="align-default" id="id2">
<img alt="../_images/lamport_limitations.jpg" src="../_images/lamport_limitations.jpg"/>
<figcaption>
<p><span class="caption-text">From this diagram, we can see that <span class="math notranslate nohighlight">\(m_1 -&gt; m_3\)</span>. We also know that <span class="math notranslate nohighlight">\(C(m_1) &lt; C(m_3)\)</span>. We can see that <span class="math notranslate nohighlight">\(m_2 -&gt; m_3\)</span> and that <span class="math notranslate nohighlight">\(C(m_2) &lt; C(m_3)\)</span>. What we cannot tell here is whether <span class="math notranslate nohighlight">\(m_1\)</span> or <span class="math notranslate nohighlight">\(m_2\)</span> caused <span class="math notranslate nohighlight">\(m_3\)</span> to be sent.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>The problem with Lamport clocks is that they do not capture causality.</p></li>
<li><p>If we know that a -&gt; c and b -&gt; c we cannot say which action initiated c.</p></li>
<li><p>This kind of information can be important when trying to replay events in a distributed system (such as when trying to recover after a crash).</p></li>
<li><p>The theory goes that if one node goes down, if we know the causal relationships between messages, then we can replay those messages and respect the causal relationship to get that node back up to the state it needs to be in.</p></li>
</ul>
</section>
<section id="vector-clocks">
<h2>Vector Clocks<a class="headerlink" href="#vector-clocks" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#vector-clocks'">¶</a></h2>
<ul class="simple">
<li><p>Vector clocks allow causality to be captured</p></li>
<li><dl class="simple">
<dt>Rules of Vector Clocks:</dt><dd><ul>
<li><p>A vector clock <span class="math notranslate nohighlight">\(VC(a)\)</span> is assigned to an event a</p></li>
<li><p>If <span class="math notranslate nohighlight">\(VC(a) &lt; VC(b)\)</span> for events a and b, then event a is known to causally precede b.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Each Process <span class="math notranslate nohighlight">\(P_i\)</span> maintains a vector <span class="math notranslate nohighlight">\(VC_i\)</span> with the following properties:</dt><dd><ul>
<li><p><span class="math notranslate nohighlight">\(VC_i[i]\)</span> is the number of events that have occurred so far at <span class="math notranslate nohighlight">\(P_i\)</span>. i.e. <span class="math notranslate nohighlight">\(VC_i[i]\)</span> is the local logical clock at process <span class="math notranslate nohighlight">\(P_i\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(VC_i[j] = k\)</span> then <span class="math notranslate nohighlight">\(P_i\)</span> knows that <span class="math notranslate nohighlight">\(k\)</span> events have occurred at <span class="math notranslate nohighlight">\(P_j\)</span>. It is thus <span class="math notranslate nohighlight">\(P_i\)</span>’s knowledge of the local time at <span class="math notranslate nohighlight">\(P_j\)</span></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="implementing-vector-clocks">
<h2>Implementing Vector Clocks<a class="headerlink" href="#implementing-vector-clocks" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#implementing-vector-clocks'">¶</a></h2>
<ul class="simple">
<li><p>The first property of the vector clock is accomplished by incrementing <span class="math notranslate nohighlight">\(VC_i[i]\)</span> at each new event that happens at process <span class="math notranslate nohighlight">\(P_i\)</span></p></li>
<li><dl class="simple">
<dt>The second property is accomplished by the following steps:</dt><dd><ol class="arabic simple">
<li><p>Before executing any event (sending a message or some internal event), <span class="math notranslate nohighlight">\(P_i\)</span> executes <span class="math notranslate nohighlight">\(VC_i[i]\)</span> &lt;- <span class="math notranslate nohighlight">\(VC_i[i] + 1\)</span></p></li>
<li><p>When process <span class="math notranslate nohighlight">\(P_i\)</span> sends a message <span class="math notranslate nohighlight">\(m\)</span> to <span class="math notranslate nohighlight">\(P_j\)</span>, it sets m’s (vector) timestamp <span class="math notranslate nohighlight">\(ts(m) = VC_i\)</span></p></li>
<li><p>Upon receiving a message <span class="math notranslate nohighlight">\(m\)</span>, process <span class="math notranslate nohighlight">\(P_j\)</span> adjusts its own vector by setting <span class="math notranslate nohighlight">\(VC_j[k]\)</span> &lt;- <span class="math notranslate nohighlight">\(max( VC_j[k], ts(m)[k] )\)</span> for each k.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</section>
<section id="so-what-did-we-get-out-of-all-of-this">
<h2>So… What Did We Get Out of All of This?<a class="headerlink" href="#so-what-did-we-get-out-of-all-of-this" title="Permalink to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#so-what-did-we-get-out-of-all-of-this'">¶</a></h2>
<ul class="simple">
<li><p>We can say if an event <span class="math notranslate nohighlight">\(a\)</span> has a timestamp <span class="math notranslate nohighlight">\(ts(a)\)</span>, then <span class="math notranslate nohighlight">\(ts(a)[i]-1\)</span> denotes the number of events processed at <span class="math notranslate nohighlight">\(P_i\)</span> that causally precede <span class="math notranslate nohighlight">\(a\)</span></p></li>
<li><p>This means that when <span class="math notranslate nohighlight">\(P_j\)</span> receives a message from <span class="math notranslate nohighlight">\(P_i\)</span> with timestamp <span class="math notranslate nohighlight">\(ts(m)\)</span>, it knows about the number of events that occured at <span class="math notranslate nohighlight">\(P_i\)</span> that causally preceded the sending of <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p>Even more importantly, <span class="math notranslate nohighlight">\(P_j\)</span> has been told how many events in <strong>other</strong> processes have taken place before <span class="math notranslate nohighlight">\(P_i\)</span> sent message <span class="math notranslate nohighlight">\(m\)</span>.</p></li>
<li><p>So, this means we could achieve a very important capability in a distributed system: we can ensure that a message is delivered only if all messages that causally precede it have also been received as well.</p></li>
<li><p>We can use this capability to build a truly distributed dataflow graph with dependencies without having a centralized coordinating process.</p></li>
</ul>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(var(--vh)-4rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#what-is-time-some-physics'" class="reference internal" href="#what-is-time-some-physics">What is Time? Some Physics</a></li>
<li><a :data-current="activeSection === '#time-and-computation'" class="reference internal" href="#time-and-computation">Time and Computation</a></li>
<li><a :data-current="activeSection === '#physical-clocks'" class="reference internal" href="#physical-clocks">Physical Clocks</a></li>
<li><a :data-current="activeSection === '#physical-clocks-multiple-systems'" class="reference internal" href="#physical-clocks-multiple-systems">Physical Clocks - Multiple Systems</a></li>
<li><a :data-current="activeSection === '#clock-synchronization'" class="reference internal" href="#clock-synchronization">Clock Synchronization</a></li>
<li><a :data-current="activeSection === '#clocks-synchronization-and-reliability'" class="reference internal" href="#clocks-synchronization-and-reliability">Clocks Synchronization and Reliability</a></li>
<li><a :data-current="activeSection === '#lamports-logical-clocks'" class="reference internal" href="#lamports-logical-clocks">Lamport’s Logical Clocks</a></li>
<li><a :data-current="activeSection === '#implementing-lamports-logical-clocks'" class="reference internal" href="#implementing-lamports-logical-clocks">Implementing Lamport’s Logical Clocks</a></li>
<li><a :data-current="activeSection === '#limitations-of-lamports-logical-clocks'" class="reference internal" href="#limitations-of-lamports-logical-clocks">Limitations of Lamport’s Logical Clocks</a></li>
<li><a :data-current="activeSection === '#vector-clocks'" class="reference internal" href="#vector-clocks">Vector Clocks</a></li>
<li><a :data-current="activeSection === '#implementing-vector-clocks'" class="reference internal" href="#implementing-vector-clocks">Implementing Vector Clocks</a></li>
<li><a :data-current="activeSection === '#so-what-did-we-get-out-of-all-of-this'" class="reference internal" href="#so-what-did-we-get-out-of-all-of-this">So… What Did We Get Out of All of This?</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2013-2019, Distributed Systems Instructors at Loyola University Chicago Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 6.2.1</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>